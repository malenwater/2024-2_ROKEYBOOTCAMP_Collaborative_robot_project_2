# 2024-2_ROKEYBOOTCAMP_Collaborative_robot_project_2
두산 로보틱스의 협동로봇인 M0609를 활용하여 다양한 상황의 과제를 해결하는 프로젝트를 진행하였다.

## ✨ Key Features

**Optimization(최적화)**

- 관절 각도로 인한 특이점 위치를 분석하고, 이를 회피하기 위한 전략을 고안하면서 경로를 추정하는 알고리즘을 구현할 것이다.

**Advanced Path Planning Algorithms(고급 경로 계획 알고리즘)**

- 선형 및 곡선 경로뿐만 아니라 스플라인 곡선을 활용하여 최적의 움직임을 설계하여 부드럽고 효율적인 로봇 동작 구현할 것이다.
<br>

## 진행한 과제 리뷰
1. 3 * 3 무작위 블럭 배열을 인위적인 순서로 정렬하기
    - 3x3 배열에 무작위로 배치된 서로 다른 크기의 블럭(각 3개)을 크기별로 구분하여 짧은 블럭, 중간 블럭, 긴 블럭 순서로 정렬한다. 이 과정에서 힘 제어를 통해 블럭의 크기를 측정하고, 확인된 길이에 따라 적절한 위치에 정렬을 수행한다.
2. 3개의 기어 사이에 작은 기어 넣기
    - 세 개의 기어 사이에 작은 기어를 삽입하기 위해 힘 제어와 회전 제어를 함께 사용한다. 힘 제어로 기어 간 접촉을 감지하고, 회전 제어로 기어의 회전을 동기화하여 기어들이 자연스럽게 맞물리도록 한다.
3. 누워있는 젠가를 세우기
    - 누워있는 젠가를 약 45도로 잡아 Z축으로 정렬한 후, 다시 약 45도로 회전하여 세우고 지정된 구역에 배치한다. 각 45도 회전은 티칭을 통해 사전에 설정된 값으로 수행된다.
4. 컵 3개를 세우기
    - 컵 3개를 세우기 위해 컵의 위 끝부분을 잡은 뒤, 중앙점을 기준으로 각 컵의 위치 좌표를 계산한다. 계산된 좌표로 이동하여 힘 제어를 통해 컵을 집고, 동일한 방식으로 힘 제어를 통해 지정된 위치에 안정적으로 놓는다.
5. 컵 10개 쌓고, 컵 1개를 뒤집어서 쌓기
    - 컵 10개를 쌓은 후, 1개의 컵을 뒤집어 쌓는다. 이를 위해 맨 아래층 6개 중 삼각형 밑변의 중앙 컵을 기준으로 위치를 설정하고, 11개의 컵 위치를 계산한 뒤 힘 제어를 통해 컵을 집고 배치한다. 컵을 뒤집는 과정에서는 Z축과 Y축 정렬을 통해 방향을 전환하며, 이 과정에서 발생할 수 있는 오차를 보정하기 위해 티칭이 필요하다.
   
## 겪었던 문제사항과 해결 방법들

  - <과제 2 - 기어 사이 기어 넣기>를 진행하던 도중, 힘 제어와 회전 제어를 같이 쓸 경우, 로봇의 모터 제어가 꺼지면서 협동 로봇이 꺼지는 현상이 발생함 이를 풀기 위해 하나씩 가설을 세우며 실험함
    - 가설 1. 동기식 회전 제어와 힘 제어를 쓰면 된다. -> 하지만 동기식 회전을 힘 제어와 같이 쓸 경우, 동기식 회전에서 코드가 넘어가지 않아서 다음 코드를 읽어서 진행해야하는데 못함, 이는 두산 협동로봇에서 동기식 회전과 힘제어를 같이 사용하도록 지원해주지 않아서 발생하는 문제이다. -> 다른 가설 추론
    - 가설 2. 비동기식 회전 제어와 힘 제어를 쓰면 된다. -> 계속해서 비동기식 회전 제어를 부르기 때문에 로봇이 오버랩 되어 진행되지 않는다.
    - 가설 3. 강사님이 제공하는 코드를 보고 이에 맞게 구조를 맞춰서 해결한다. -> 동작원리는 동일하나 동작하지 않음
    - 가설 4. 단위를 쪼개서 그냥 회전 제어 말고, 힘 제어만을 이용해서 기어가 부딪치는 상황없이 실험한다. -> 그래도 로봇이 꺼지는 현상 발생
    - 가설 5. 힘 제어를 잠깐 키고 끄는 상황을 실험한다. -> 로봇이 꺼지는 현상 발생
    - 가설 6. 힘 제어가 어느부분에서 셧다운 되는 지를 print로 찍어 확인한다. -> 문제 발견 - 힘 제어를 끄는 부분에서 get_current_posx()라는 함수를 사용할 경우 죽는 상황 발생
    - 가설 7. get_current_posx()라는 현재 위치를 가져와서 일정 높이를 비교하는 구문을 삭제하고 check_position_contision()함수를 사용하여 일정 높이에 있는지 체크하여 동기식 회전 제어와 힘 제어를 사용  -> 기어 사이 기어 넣기를 성공

  - <과제 3 - 누워있는 젠가 세우기>를 진행하던 도중, parallel_axis가 x,y,z축 정렬만 하고, 축으로 부터 몇도 떨어져서 정렬 되지 않는다는 것을 몰라 헤맴,x,y,z축의 회전 경우, 티칭으로 해결하는 것이 더 빠르다. 만약 parallel_axis을 사용할 경우, 오차에 대한 값을 moveL을 통해 보정해줘야한다.
  
  - <과제 5(제출 과제) - 컵 10개 쌓고, 마지막에 뒤집어서 쌓기>를 진행하던 도중, 속도와 가속도의 값을 높여도, movel의 속도가 높아지지 않는 문제가 있었다. 이에 따라 movesx를 사용하고, 아큐먼트에 time을 설정하여, 로봇이 알아서 시간을 맞추기 위해 속도를 제어하게 되어 속도가 느리다는 문제를 해결할 수 있었다.
  - <과제 5(제출 과제) - 컵 10개 쌓고, 마지막에 뒤집어서 쌓기>를 진행하던 도중, movesx를 사용하게 되면서 movesx의 관성에 의해 기존에 놓여있던 컵을 치게 되는 문제가 발생하였다. 이를 해결하기 위해 기존에 movesx의 경로가 컵을 놓을 위치 z방향으로만 값을 줬었지만 x방향으로도 값을 줌으로써 관성이 줄어들도록 하여 기존 컵을 치지 않도록 만들어 문제를 해결했다.
  - <과제 5(제출 과제) - 컵 10개 쌓고, 마지막에 뒤집어서 쌓기>를 진행하던 도중, 컵을 집을 때, 그리퍼가 완전히 열린 뒤, 내려가고, 집어야하지만, 그리퍼가 열리는 동시에 내려가서 컵을 누르는 문제가 생겼다. 이를 해결하기 위해 wait를 줘서 잠시 대기한 후 그리퍼가 움직일 수 있도록 하였다.
  - <과제 5(제출 과제) - 컵 10개 쌓고, 마지막에 뒤집어서 쌓기>를 진행하던 도중, 마지막 컵을 뒤집는 경우에서 parallel_axis를 사용했기 때문에 정렬시 오차가 발생하여 컵을 집을 수 없는 문제가 발생했다.. 이 오차를 movel로 실험적으로 값을 뽑아내어 오차를 줄일 수 있었다.
## 🎥 Demo Video
  - [과제 1(homework1) - 무작위 블럭 배열을 인위적인 배열로 정렬 <유튜브>](https://youtu.be/ztsOVRzARyI)
  - [과제 2(homework2) - 기어 사이 기어 넣기 <유튜브>](https://youtu.be/jz2EHEQGh78)
  - [과제 3(homework3) - 누워있는 젠가 세우기 <유튜브>](https://youtu.be/uzCFj7mDgfo)
  - [과제 4(homework4) - 컵 3개 세우기 <유튜브>](https://youtu.be/pcc3xkfMvAg)
  - [과제 5(제출 과제) - 컵 10개 쌓고, 마지막에 뒤집어서 쌓기 <유튜브>](https://youtu.be/tilhtvge_kU)

### Source
 - src/dosan_pkg 내부에 제공해준 패키지를 넣어 사용한다.
https://github.com/Juwan-s/doosan-robot2

## 프로젝트 문제점과 해결할 방안
|이름|문제점|개선할 방안|역할|
|---|---|---|---|
|[이선우](https://github.com/malenwater)|1. 해당 프로젝트는 과제가 5개가 순차적으로 이어지면서 주어진 시간 내에 모든 과제를 완료해야 한다. 2. 매번 ROS2의 서비스, 토픽을 날려서 로봇의 위치, 그리퍼 제어, 로봇 제어를 위한 launch 파일을 실행해야한다. |1. 해당 프로젝트를 주어진 시간 내에 처리하기 위해 ROS 패키지를 파고, 이 패키지 내에 각각의 폴더를 만들어서 과제를 관리하였다. 이를 통해서 각각의 패키지에서 어떤 내용을 하는지 한눈에 볼 수 있었다. 또한 실행 파일과 기능 파일을 따로 분리하여 실행 파일에는 기본적인 세팅값을 넣고, 기능 파일로 부터 함수를 호출하여 실행한다. 기능 파일은 각각의 함수가 주어진 기능을 수행한다. 예를 들면 그리퍼가 집는 함수와 놓는 함수를 정의해놓고 사용하는 것이다. 이를 통해 각각의 과제를 수행할 때마다 어떤 식으로 코드를 짰는지 확인하고 약간의 수정을 통해 빠른 시간 내에 과제를 수행할 수 있었다. 2. 빠른 테스팅을 위해 ROS2 명령어를 bash 파일로 만들어서 배쉬 파일을 실행하는 것을 통해 ROS2 명령어를 실행하게 만들었다. 이를 통해 복사 붙여넣기로 제어하는 것이 아닌 배쉬 파일 실행으로 제어할 수 있기 때문에 더 편리하게 제어할 수 있다.|알고리즘 코드 작성, 테스팅|
|[류승기](https://github.com/RyuSeunggi)|더미|더미|알고리즘 설계, 테스팅|
|[최민호](https://github.com/ccccmh)|더미|더미|알고리즘 설계, 테스팅|
